<?phpnamespace App\Http\Controllers;use App\Models\Completion15;use App\Models\Student;use Illuminate\Http\Request;use Mpdf;class Completion15Controller extends Controller{//单摆    public  function completion15(Request  $request)    {        $l1 =$request['l1'];        $l2 = $request['l2'];        $l3 = $request['l3'];        $l4 = $request['l4'];        $l5 = $request['l5'];        $d1 = $request['d1'];        $d2 = $request['d2'];        $d3 = $request['d3'];        $d4 =$request['d4'];        $d5 =$request['d5'];        $t1 = $request['t1'];        $t2 = $request['t2'];        $t3 = $request['t3'];        $t4 = $request['t4'];        $t5 = $request['t5'];        $ld1 = $request['ld1'];        $ld2 = $request['ld2'];        $ld3 = $request['ld3'];        $ld4 = $request['ld4'];        $ld5 = $request['ld5'];        $l6 =$request['l6'];        $tt1 = $request['tt1'];        $tt2 = $request['tt2'];        $tt3 = $request['tt3'];        $tt4 = $request['tt4'];        $tt5 = $request['tt5'];        $t6 = $request['t6'];        $g   =$request['g'];        $n1  =$request['n1'];        $n2  =$request['n2'];        $n3  =$request['n3'];        $n4  =$request['n4'];        $n5  =$request['n5'];        $n6  =$request['n6'];        $y1  =$request['y1'];        $y2  =$request['y2'];        $xz1  =$request['xz1'];        $xz2  =$request['xz2'];        $grade_xp = $request['grade_xp'];        $student_id = $request['student_id'];        $res1 = Completion15::establish(            $l1,            $l2,            $l3,            $l4,            $l5,            $d1,            $d2,            $d3,            $d4,            $d5,            $t1,            $t2,            $t3,            $t4,            $t5,            $ld1,            $ld2,            $ld3,            $ld4,            $ld5,            $l6,            $tt1,            $tt2,            $tt3,            $tt4,            $tt5,            $t6,            $g,            $n1,            $n2,            $n3,            $n4,            $n5,            $n6,            $y1,            $y2,            $xz1,            $xz2,            $student_id        );        Student::statechange($student_id);        $grade=0;        if (strlen(substr(strrchr($l1,"."),1)) == 2){            $grade += 1;        }        if(strlen(substr(strrchr($l2,"."),1)) == 2){            $grade += 1;        }        if(strlen(substr(strrchr($l3,"."),1)) == 2){            $grade += 1;        }        if(strlen(substr(strrchr($l4,"."),1)) == 2){            $grade += 1;        }        if(strlen(substr(strrchr($l5,"."),1)) == 2){            $grade += 1;        }        if(strlen(substr(strrchr($d1,"."),1)) == 3){            $grade += 1;        }        if(strlen(substr(strrchr($d2,"."),1)) == 3){            $grade += 1;        }        if(strlen(substr(strrchr($d3,"."),1)) == 3){            $grade += 1;        }        if(strlen(substr(strrchr($d4,"."),1)) == 3){            $grade += 1;        }        if(strlen(substr(strrchr($d5,"."),1)) == 3){            $grade += 1;        }        if(strlen(substr(strrchr($t1,"."),1)) == 2){            $grade += 1;        }        if(strlen(substr(strrchr($t2,"."),1)) == 2){            $grade += 1;        }        if(strlen(substr(strrchr($t3,"."),1)) == 2){            $grade += 1;        }        if(strlen(substr(strrchr($t4,"."),1)) == 2){            $grade += 1;        }        if(strlen(substr(strrchr($t5,"."),1)) == 2){            $grade += 1;        }       // dd(sprintf("%.2f",($l1+$d1/2)));        if($ld1==sprintf("%.2f",($l1+$d1/2))&&strlen(substr(strrchr($ld1,"."),1)) == 2){            $grade += 1;        }        if($ld2==sprintf("%.2f",($l2+$d2/2))&&strlen(substr(strrchr($ld2,"."),1)) == 2){            $grade += 1;        }        if($ld3==sprintf("%.2f",($l3+$d3/2))&&strlen(substr(strrchr($ld3,"."),1)) == 2){            $grade += 1;        }        if($ld4==sprintf("%.2f",($l4+$d4/2))&&strlen(substr(strrchr($ld4,"."),1)) == 2){            $grade += 1;        }        if($ld5==sprintf("%.2f",($l5+$d5/2))&&strlen(substr(strrchr($ld5,"."),1)) == 2){            $grade += 1;        }        $la=($ld1+$ld2+$ld3+$ld4+$ld5)/5;        if($l6== sprintf("%.2f",$la)  && strlen(substr(strrchr($l6,"."),1)) == 2) {            $grade += 5;        }            if ($tt1 == sprintf("%.3f", ($t1 / 20)) && strlen(substr(strrchr($tt1, "."), 1)) == 3) {                $grade += 1;            }            if ($tt2 == sprintf("%.3f", ($t2 / 20)) && strlen(substr(strrchr($tt2, "."), 1)) == 3) {                $grade += 1;            }            if ($tt3 == sprintf("%.3f", ($t3 / 20)) && strlen(substr(strrchr($tt3, "."), 1)) == 3) {                $grade += 1;            }            if ($tt4 == sprintf("%.3f", ($t4 / 20)) && strlen(substr(strrchr($tt4, "."), 1)) == 3) {                $grade += 1;            }            if ($tt5 == sprintf("%.3f", ($t5 / 20)) && strlen(substr(strrchr($tt5, "."), 1)) == 3) {                $grade += 1;            }            $ta = ($tt1 + $tt2 + $tt3 + $tt4 + $tt5) / 5;            if ($t6 == sprintf("%.3f", $ta) && strlen(substr(strrchr($t6, "."), 1)) == 3) {                $grade += 5;            }           // dd(floatval(geteffective(4*3.14*3.14*$l6/($t6*$t6),4)));            //geteffective(a,b) 把数字a 转换成b位的有效数 geteffective(23.22,3)= 23.20            //floatval(a) 把a转换成浮点型            // dd(floatval($g));            if (floatval($g)==geteffective(4*3.14*3.14*$l6/($t6*$t6),4)&&effective($g) == 4) {                $grade += 10;            }      //  dd(round((abs($ld1-$l6)+abs($ld2-$l6)+abs($ld3-$l6)+abs($ld4-$l6)+abs($ld5-$l6))/5,3));            //abs绝对值            if (floatval($n1)==geteffective(round((abs($ld1-$l6)+abs($ld2-$l6)+abs($ld3-$l6)+abs($ld4-$l6)+abs($ld5-$l6))/5,3),2)&&effective($n1) == 2) {                $grade += 5;            }            if (floatval($n2)==geteffective(round($n1/$l6*100,3),2)&&effective($n2) == 2) {                $grade += 5;            }            if (floatval($n3)==geteffective(round((abs($tt1-$t6)+abs($tt2-$t6)+abs($tt3-$t6)+abs($tt4-$t6)+abs($tt5-$t6))/5,6),2)&&effective($n3) == 2)  {                $grade += 5;            }            if (floatval($n4)==round((geteffective(($n3/$t6),2)*100),2)&&(effective($n4) == 2)) {                $grade += 5;            }            //g的相对误差            if (floatval($n5)==round(geteffective(($n2+2*$n4),2),3)&&effective($n5) == 2) {                $grade += 5;            }            if (floatval($n6)==geteffective(($g*$n5)/100,2)&&effective($n6) == 2) {                $grade += 5;            }            if($y1>=100&&$y1<=999)            {   $vis=1;               if (floatval($y1)==round($g,0))                $grade += 7.5;            }          if($y1>=1000&&$y1<=9999)          {              $vis=2;            if ($y1==$g)                $grade += 7.5;           }        if($vis==1)  //3位数        {            if($n6<0.1&&$y2==0.1)  //<0.1 $y2=0.1            {                $grade += 7.5;            }            if (floatval($y2)==round($n6,1)) // >0.1 0.2 0.3 2.3 4.5 5.6            {                $grade += 7.5;            }        }        if($vis==2)        {            if (round($n6)==$y2&&$n6>=1&&$n6<10)        {            $grade += 7.5;        }        }            $grade = $grade + $grade_xp;                    $res2 = Student::grade($student_id, $grade, $grade_xp);            $res['res1'] = $res1;            $res['res2'] = $res2;            return $res1 ?                json_success('操作成功!', $res1, 200) :                json_fail('操作失败!', null, 100);        }    public function pdf15(Request $request)    {        $student_id = $request['student_id'];        $student_a = Completion15::show15($student_id);        $student_b = json_decode($student_a);        $l1 = $student_b[0]->l1;        $l2 = $student_b[0]->l2;        $l3 = $student_b[0]->l3;        $l4 = $student_b[0]->l4;        $l5 = $student_b[0]->l5;        $d1=  $student_b[0]->d1;        $d2 = $student_b[0]->d2;        $d3 = $student_b[0]->d3;        $d4 = $student_b[0]->d4;        $d5 = $student_b[0]->d5;        $t1 = $student_b[0]->t1;        $t2 = $student_b[0]->t2;        $t3 = $student_b[0]->t3;        $t4 = $student_b[0]->t4;        $t5 = $student_b[0]->t5;        $ld1 = $student_b[0]->ld1;        $ld2 = $student_b[0]->ld2;        $ld3 = $student_b[0]->ld3;        $ld4 = $student_b[0]->ld4;        $ld5 = $student_b[0]->ld5;        $l6 = $student_b[0]->l6;        $tt1 = $student_b[0]->tt1;        $tt2 = $student_b[0]->tt2;        $tt3 = $student_b[0]->tt3;        $tt4 = $student_b[0]->tt4;        $tt5 = $student_b[0]->tt5;        $t6 = $student_b[0]->t6;        $g = $student_b[0]->g;        $n1= $student_b[0]->n1;        $n2 = $student_b[0]->n2;        $n3 = $student_b[0]->n3;        $n4 = $student_b[0]->n4;        $n5 = $student_b[0]->n5;        $n6 = $student_b[0]->n6;        $y1 = $student_b[0]->y1;        $y2 = $student_b[0]->y2;        $xz1 = $student_b[0]->xz1;        $xz2 = $student_b[0]->xz2;        $student_name = $student_b[0]->student_name;        $student_level = $student_b[0]->student_level;        $student_spec = $student_b[0]->student_spec;        $student_year = $student_b[0]->student_year;        $student_class = $student_b[0]->student_class;        $student_num = $student_b[0]->student_num;        $experiment_name = $student_b[0]->experiment_name;        $course_name = $student_b[0]->course_name;        $student_date = $student_b[0]->student_date;        $student_teacher = $student_b[0]->student_teacher;        $grade = $student_b[0]->grade;        $grade_xp = $student_b[0]->grade_xp;        $res = view('danbai', [            'name' => $student_name,            'student_level' => $student_level,            'student_spec' => $student_spec,            'student_year' => $student_year,            'experiment_name' => $experiment_name,            'course_name' => $course_name,            'student_date' => $student_date,            'student_teacher' => $student_teacher,            'student_num' => $student_num,            'student_class' => $student_class,            'grade' => $grade,            'grade_xp' => $grade_xp,            'grade_tk' => ($grade - $grade_xp),            'l1' => $l1,            'l2' => $l2,            'l3' => $l3,            'l4' => $l4,            'l5' => $l5,            'd1' => $d1,            'd2' => $d2,            'd3' => $d3,            'd4' => $d4,            'd5' => $d5,            't1' => $t1,            't2' => $t2,            't3' => $t3,            't4' => $t4,            't5' => $t5,            'ld1' => $ld1,            'ld2' => $ld2,            'ld3' => $ld3,            'ld4' => $ld4,            'ld5' => $ld5,            'l6' => $l6,            'tt1' => $tt1,            'tt2' => $tt2,            'tt3' => $tt3,            'tt4' => $tt4,            'tt5' => $tt5,            't6' => $t6,            'g' => $g,            'n1' => $n1,            'n2' => $n2,            'n3' => $n3,            'n4' => $n4,            'n5' => $n5,            'n6' => $n6,            'y1' => $y1,            'y2' => $y2,            'xz1' => $xz1,            'xz2' => $xz2,        ]);        $mpdf = new Mpdf\Mpdf(['utf-8', 'A4', 16, '', 10, 10, 15, 15]);        $mpdf->showImageErrors = true;        $mpdf->WriteHTML($res);        $mpdf->Output($student_num.'-'.$student_name.'-'.$experiment_name.".pdf", "D");        exit;    }}